<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>JP Train Station</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha512-Zcn6bjR/8RZbLEpLIeOwNtzREBAJnUKESxces60Mpoj+2okopSAcSUIUOseddDm0cxnGQzxIR7vJgsLZbdLE3w=="
      crossorigin=""
    >
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css"
    >
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css"
    >
    <link rel="stylesheet" href="styles.css">
  </head>
  <body>
    <a class="skip-link" href="#stationPanel">Skip to station details</a>
    <div id="map" class="map" role="application" aria-label="Interactive map of Japan"></div>
    <div class="map-overlay top" role="search">
      <div class="overlay-header">
        <div>
          <div class="brand">JP Train Station</div>
          <p class="overlay-subtitle">Melodies, operators, and lines across Japan</p>
        </div>
        <button
          id="resetView"
          class="btn btn-secondary"
          type="button"
          disabled
          aria-label="Reset the map view to the current selection"
        >
          Reset view
        </button>
      </div>
      <form id="stationSearch" class="search" autocomplete="off">
        <label class="sr-only" for="stationQuery">Search for a station</label>
        <input
          id="stationQuery"
          name="stationQuery"
          type="search"
          placeholder="Search for a station"
          inputmode="search"
          list="stationSuggestions"
          aria-describedby="searchHint filterSummary"
        >
        <datalist id="stationSuggestions"></datalist>
        <button class="btn" type="submit" aria-label="Search stations">Search</button>
      </form>
      <section class="filter-panel" aria-label="Station filters">
        <header class="filter-header">
          <h2>Filter by operator and line</h2>
          <p id="filtersHelp" class="filter-helper">
            Combine the filters below with the station search to focus on specific rail operators or train lines.
          </p>
        </header>
        <div class="filter-groups">
          <div class="filter-group">
            <label for="operatorSearch">Operators</label>
            <input
              id="operatorSearch"
              class="filter-search"
              type="search"
              placeholder="Search operators"
              aria-describedby="operatorHelper"
              inputmode="search"
            >
            <p id="operatorHelper" class="filter-helper-text">
              Tap or hold Ctrl/Cmd while selecting to choose multiple operators.
            </p>
            <select
              id="operatorFilter"
              class="filter-select"
              name="operatorFilter"
              multiple
              size="6"
              aria-describedby="operatorHelper filtersHelp filterSummary"
            ></select>
          </div>
          <div class="filter-group">
            <label for="lineSearch">Lines</label>
            <input
              id="lineSearch"
              class="filter-search"
              type="search"
              placeholder="Search lines"
              aria-describedby="lineHelper"
              inputmode="search"
            >
            <p id="lineHelper" class="filter-helper-text">
              Select one or more lines to instantly update the map markers.
            </p>
            <select
              id="lineFilter"
              class="filter-select"
              name="lineFilter"
              multiple
              size="6"
              aria-describedby="lineHelper filtersHelp filterSummary"
            ></select>
          </div>
        </div>
        <div class="filter-actions">
          <p id="filterSummary" class="filter-summary" aria-live="polite"></p>
          <div class="filter-buttons">
            <button id="clearFilters" class="btn btn-secondary" type="button">Clear filters</button>
          </div>
        </div>
      </section>
      <p id="searchHint" class="search-hint">
        Search by station name or combine operator and line filters to explore melodies with precision.
      </p>
    </div>
    <section id="stationPanel" class="station-panel" aria-live="polite">
      <header class="panel-header">
        <h1 id="stationName">Explore Japan's railways</h1>
        <p id="stationSummary">Use the map or search above to find a station and listen to its melodies.</p>
      </header>
      <p id="panelHelper" class="panel-helper">
        Tip: Selected operators and lines will glow below so you can confirm how your filters affect each station.
      </p>
      <dl class="station-meta">
        <div>
          <dt>Served lines</dt>
          <dd>
            <div id="stationLines" class="meta-pill-group" role="list">—</div>
          </dd>
        </div>
        <div>
          <dt>Operators</dt>
          <dd>
            <div id="stationOperators" class="meta-pill-group" role="list">—</div>
          </dd>
        </div>
        <div>
          <dt>Platforms</dt>
          <dd id="stationPlatforms">—</dd>
        </div>
      </dl>
      <section class="audio" aria-label="Station melodies">
        <h2>Station melodies</h2>
        <p id="audioStatus" class="audio-status">Select a station to unlock its arrival and departure tunes.</p>
        <div class="audio-controls">
          <button id="playArrival" class="btn audio-btn" type="button" disabled>
            <span class="play">Play arrival</span>
            <span class="pause">Pause</span>
          </button>
          <button id="playDeparture" class="btn audio-btn" type="button" disabled>
            <span class="play">Play departure</span>
            <span class="pause">Pause</span>
          </button>
          <button id="stop" class="btn" type="button" disabled>Stop</button>
        </div>
        <audio id="melodyPlayer" preload="auto" tabindex="-1"></audio>
      </section>
    </section>
    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha512-BwHfrr4c9kmRkLw6iXFdzcdWV/PGkVgiIyIWLLlTSXzWQzxuSg4DiQUCpauz/EWjgk5TYQqX/kvn9pG1NpYfqg=="
      crossorigin=""
      defer
    ></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js" defer></script>
    <script src="app.js" type="module" defer></script>
  </body>
</html>
